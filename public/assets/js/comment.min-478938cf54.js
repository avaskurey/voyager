"use strict";var Comment=React.createClass({displayName:"Comment",getInitialState:function(){return{replyMode:!1,errors:[],submitting:!1,success:!1,liking:!1,disliking:!1,liked:!1,disliked:!1,nameAvailabiltyLoading:!1,nameAvailabiltyCurrent:null,nameAvailable:null,charCount:450}},componentDidMount:function(){this.setState({likes:this.props.comment.likes,dislikes:this.props.comment.dislikes})},handleRepliesSubmit:function(e){e.preventDefault();var t={name:$("#comment"+this.props.id+" #name").val(),comment:$("#comment"+this.props.id+" #comment").val(),article_id:this.props.article_id,parent_id:this.props.id,agree:0==$("#comment"+this.props.id+" #agree:checked").length?0:1,_token:$('meta[name="csrf-token"]').attr("content"),avatar_color:$("#comment"+this.props.id+" #avatarColor").val()};if(null!=this.props.account)var t={name:this.props.account.dhivehi_name,comment:$("#comment"+this.props.id+" #comment").val(),article_id:this.props.article_id,parent_id:this.props.id,agree:0==$("#comment"+this.props.id+" #agree:checked").length?0:1,_token:$('meta[name="csrf-token"]').attr("content"),avatar_color:$("#comment"+this.props.id+" #avatarColor").val(),member_id:this.props.account.id};this.setState({submitting:!0}),$.ajax({url:"/json/dhivehi/comments",data:t,method:"POST",dataType:"json",success:function(e){$("#comment"+this.props.id+" .comment-form").trigger("reset"),$("#comment"+this.props.id+" .comment-form").slideUp(),this.setState({submitting:!1,submitted:!0})}.bind(this),error:function(e,t,a){if(e.responseJSON){this.setState({errors:JSON.parse(e.responseText),submitting:!1});for(var n in e.responseJSON)$("#comment"+this.props.id+" #"+n).parent().parent().addClass("has-error")}}.bind(this)})},handleLike:function(){this.state.liked||(this.setState({liking:!0}),$.ajax({url:"/json/dhivehi/comments/thumb",method:"POST",data:{comment_id:this.props.id,action:1,_token:$('meta[name="csrf-token"]').attr("content")},dataType:"json",success:function(e){this.setState({liking:!1,likes:this.props.comment.likes+1,liked:!0})}.bind(this),error:function(e,t,a){this.setState({disliking:!1})}.bind(this)}))},handleDislike:function(){this.state.disliked||(this.setState({disliking:!0}),$.ajax({url:"/json/dhivehi/comments/thumb",method:"POST",data:{comment_id:this.props.id,action:2},dataType:"json",success:function(e){this.setState({disliking:!1,dislikes:this.props.comment.dislikes+1,disliked:!0,_token:$('meta[name="csrf-token"]').attr("content")})}.bind(this),error:function(e,t,a){this.setState({disliking:!1})}.bind(this)}))},enableEditMode:function(){this.setState({replyMode:!0})},nameAvailabilty:function(){var e=$(".reply-comment #name").val().trim(),t=$('meta[name="csrf-token"]').attr("content");this.setState({nameAvailabiltyCurrent:e}),this.setState({nameAvailable:null}),e.length>3&&""!=e&&0==this.state.nameAvailabiltyLoading&&(this.setState({nameAvailabiltyLoading:!0}),$.ajax({url:"/auth/name_available",data:{_token:t,dhivehi_name:e},method:"POST",dataType:"json",cache:!1,success:function(t){this.setState({nameAvailabiltyLoading:!1}),this.setState({nameAvailable:t}),this.state.nameAvailabiltyCurrent!=e&&this.nameAvailabilty()}.bind(this),error:function(e,t,a){}.bind(this)}))},charLimit:function(){var e=$(".reply-comment #comment").val().trim(),t=e.length,a=450,n=a-t;this.setState({charCount:n})},render:function(){var e="",t=function(e){return React.createElement("svg",{width:"66px",height:"57px",viewBox:"0 0 66 57",version:"1.1"},React.createElement("title",null,"Combined Shape"),React.createElement("desc",null,"Created with Sketch."),React.createElement("defs",null),React.createElement("g",{id:"Page-1",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},React.createElement("g",{id:"sample",transform:"translate(-396.000000, -235.000000)",fill:e},React.createElement("path",{d:"M452.113782,291.554702 C448.996553,287.993711 442.086847,282.552011 428.968432,282.552011 C415.889009,282.552011 408.983181,287.96141 405.853865,291.5229 C399.771428,285.537422 396,277.210166 396,268 C396,249.774603 410.770596,235 429,235 C447.225397,235 462,249.770596 462,268 C462,277.225223 458.215593,285.566312 452.113782,291.554702 Z M429,276 C436.179702,276 442,270.179702 442,263 C442,255.820298 436.179702,250 429,250 C421.820298,250 416,255.820298 416,263 C416,270.179702 421.820298,276 429,276 Z",id:"Combined-Shape"}))))};this.state.replyMode&&!this.state.submitted?e=React.createElement(CommentForm,{account:this.props.account,avatarColor:this.props.avatarColor,nameAvailabilty:this.nameAvailabilty,nameAvailable:this.state.nameAvailable,nameAvailabiltyLoading:this.state.nameAvailabiltyLoading,charLimit:this.charLimit,charCount:this.state.charCount,replyMode:"true",handleSubmit:this.handleRepliesSubmit,errors:this.state.errors,handleNameChange:this.handleNameChange,submitting:this.state.submitting,handleCommentChange:this.handleCommentChange}):this.state.submitted&&(e=React.createElement(CommentSuccess,null));var a="";"true"!=this.props.child&&(a=React.createElement("a",{onClick:this.enableEditMode,className:"action-btn"},"Reply"));var n;n=this.state.liking?React.createElement("i",{className:"fa fa-circle-o-notch fa-spin"}):React.createElement("i",{className:"counter"},this.state.likes);var s;s=this.state.disliking?React.createElement("i",{className:"fa fa-circle-o-notch fa-spin"}):React.createElement("i",{className:"counter"},this.state.dislikes);var i=(React.createElement("a",{className:"action-btn"},"Report"),React.createElement("span",{className:"commenter"},this.props.comment.user?this.props.comment.user.dhivehi_name:this.props.comment.name));this.props.comment.user&&null==this.props.comment.user.dhivehi_name&&(i=React.createElement("span",{className:"commenter commenter-english"},this.props.comment.user.name));var r=t("#A9A9A9"),c=t("#A9A9A9");return r=this.props.comment.user&&null!=this.props.comment.user.avatar?React.createElement("img",{src:this.props.comment.user.avatar}):null!=this.props.comment.avatar_color?t(this.props.comment.avatar_color):c,React.createElement("div",{className:"comment-row",id:"comment"+this.props.id},React.createElement("div",{className:"user"},r,React.createElement("div",{className:"commenter-details"},i,React.createElement("span",{className:"time"},this.props.comment.date_formatted)),React.createElement("span",{className:"clearfix"})),React.createElement("p",null,this.props.children),React.createElement("div",{className:"comment-opts row"},React.createElement("div",{className:"text-left col-sm-6"},React.createElement("a",{onClick:this.handleDislike,className:"comment-like-btn dislike"},React.createElement("span",null,s)),React.createElement("a",{onClick:this.handleLike,className:"comment-like-btn like"},React.createElement("span",null,n))),React.createElement("div",{className:"text-right col-sm-6"},a)),e,this.props.childs)}}),LoginOptions=React.createClass({displayName:"LoginOptions",render:function(){return React.createElement("div",{className:"login-options"},React.createElement("a",{href:"#",className:"btn cmmnt-btn"},"ލޮގިން"),React.createElement("a",{href:"#",className:"btn cmmnt-btn"},"ރަޖިސްޓަރ"),React.createElement("span",{className:"or-seperator"},"ނޫނީ"),React.createElement("a",{href:"#",className:"btn cmmnt-btn"},"ކޮމެންޓެއް ފޮނުވާ"))}}),CommentList=React.createClass({displayName:"CommentList",sortByDate:function(){this.props.onChange("date")},sortByLikes:function(){this.props.onChange("likes")},render:function(){var e=this.props.avatarColor,t=this.props.account,a=this.props.data.map(function(a){if(a.children)var n=a.children.map(function(a){return React.createElement(Comment,{account:t,avatarColor:e,comment:a,id:a.id,child:"true",key:a.id},a.comment)});else var n="";return React.createElement(Comment,{account:t,avatarColor:e,comment:a,id:a.id,article_id:a.article_id,key:a.id,childs:n},a.comment)}),n="";return React.createElement("div",{className:"comments-holder"},n,a)}}),CommentSuccess=React.createClass({displayName:"CommentSuccess",render:function(){return React.createElement("div",{className:"alert alert-success"},"ތިޔަ ކޮމެންޓު ލިބިއްޖެ. ޝުކުރިއްޔާ!")}}),CommentErrorRow=React.createClass({displayName:"CommentErrorRow",render:function(){var e=null;return this.props.error.length>0&&(e=this.props.error.map(function(e,t){return React.createElement("li",{key:t},e)})),React.createElement("ul",null,e)}}),CommentErrors=React.createClass({displayName:"CommentErrors",render:function(){var e=this,t=Object.keys(this.props.errors).map(function(t){return e.props.errors[t]}),a=t.map(function(e,t){return React.createElement(CommentErrorRow,{error:e,key:t})});return React.createElement("div",{className:"alert alert-danger",role:"alert"},React.createElement("span",{className:"sr-only"},"Error:"),a)}}),CommentForm=React.createClass({displayName:"CommentForm",componentDidMount:function(){$(".comment-form .thaana").thaana()},render:function(){var e;Object.keys(this.props.errors).length>0&&(e=React.createElement(CommentErrors,{errors:this.props.errors}));var t="";null!=this.props.account&&(t="hidden");var a="",n="",s=!0;if(null!=this.props.nameAvailable&&void 0!=this.props.nameAvailable){var i=this.props.nameAvailable,r="";1==i.valid?(r=React.createElement("span",null,"the name is available"),a="has-success",n=React.createElement("span",null,"The name is available. ",React.createElement("a",{href:"/auth/register?dhivehi_name="+this.props.nameAvailable.dhivehi_name},"Register?")),s=!1):(r=React.createElement("span",null,"the name is not available"),a="has-error",n="The name is already taken",s=!0)}var c,o,m=function(e){return React.createElement("svg",{width:"45px",height:"57px",viewBox:"0 0 66 57",version:"1.1"},React.createElement("title",null,"Combined Shape"),React.createElement("desc",null,"Created with Sketch."),React.createElement("defs",null),React.createElement("g",{id:"Page-1",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},React.createElement("g",{id:"sample",transform:"translate(-396.000000, -235.000000)",fill:e},React.createElement("path",{d:"M452.113782,291.554702 C448.996553,287.993711 442.086847,282.552011 428.968432,282.552011 C415.889009,282.552011 408.983181,287.96141 405.853865,291.5229 C399.771428,285.537422 396,277.210166 396,268 C396,249.774603 410.770596,235 429,235 C447.225397,235 462,249.770596 462,268 C462,277.225223 458.215593,285.566312 452.113782,291.554702 Z M429,276 C436.179702,276 442,270.179702 442,263 C442,255.820298 436.179702,250 429,250 C421.820298,250 416,255.820298 416,263 C416,270.179702 421.820298,276 429,276 Z",id:"Combined-Shape"}))))};if(this.props.account){s=!1,o=null!=this.props.account.dhivehi_name?React.createElement("span",{className:"name dhivehi-name"},this.props.account.dhivehi_name):React.createElement("span",{className:"name"},React.createElement("a",{href:"/auth/user?rf=comments"},"(set a dhivehi name)")," ",this.props.account.name);var l=m(this.props.avatarColor);null!=this.props.account.avatar&&(l=React.createElement("img",{src:this.props.account.avatar})),c=React.createElement("div",{id:"commentAccount",className:"col-sm-12"},React.createElement("div",{className:"profile"},React.createElement("div",{className:"image"},l),React.createElement("div",null,o,React.createElement("span",{className:"account-endpoints"},React.createElement("a",{href:"/auth/user?rf=comments"},"Account Settings")))))}else void 0==this.props.replyMode&&(c=React.createElement("div",{id:"commentAccount",className:"col-sm-12"},React.createElement("div",{className:"account-actions col-md-7 col-sm-12"},React.createElement("span",{className:"buttons"},React.createElement("a",{href:"/auth/register?rf=comment",className:"register"},"Register"),React.createElement("a",{href:"/auth/login?rf=comment"},"Sign in"))),React.createElement("div",{className:"connect-with col-md-5 col-sm-12"},React.createElement("p",null,"Connect with"),React.createElement("ul",null,React.createElement("li",null,React.createElement("a",{href:"/auth/login?rf=comment-social"},React.createElement("img",{src:"/build/assets/images/rnd-icon-gp.svg"}))),React.createElement("li",null,React.createElement("a",{href:"/auth/login?rf=comment-social"},React.createElement("img",{src:"/build/assets/images/rnd-icon-tw.svg"}))),React.createElement("li",null,React.createElement("a",{href:"/auth/login?rf=comment-social"},React.createElement("img",{src:"/build/assets/images/rnd-icon-fb.svg"})))))));var h;this.props.account||(h=React.createElement("div",{className:"clr"},React.createElement("br",null)));var d=!1;this.props.charCount<1&&(d=!0);return React.createElement("form",{className:"comment-form form-horizontal"+("true"!=this.props.replyMode?" main-comment":" reply-comment"),onSubmit:this.props.handleSubmit},c,h,e,React.createElement("div",{className:null==this.props.account?"comment-form-in":"comment-form-in-account"},React.createElement("div",{className:null!=this.props.account?"hidden":"user-avatar-wo-account"},m(this.props.avatarColor)),React.createElement("div",{className:null==this.props.account?"comment-form-in-fields-container":"comment-form-in-fields-container-account"},React.createElement("div",{className:a+" form-group form-group-name "+(this.props.errors.name?"has-error":""+(null==this.props.account?"":" hidden"))},React.createElement("div",{className:"col-sm-12"},React.createElement("input",{style:{display:"inline-block"},type:"text",name:"name",id:"name",className:"form-control thaana",onChange:this.props.nameAvailabilty,placeholder:"ނަން",maxLength:"30"}),React.createElement("div",{style:{height:"17px",marginTop:"5px"}},React.createElement("span",{className:"pull-right clear-fix",style:{fontSize:"12px",direction:"ltr",textAlign:"right"}},n)))),React.createElement("div",{className:"form-group "+(this.props.errors.comment?"has-error":"")+(this.props.charCount<1?"has-error":"")},React.createElement("div",{className:"col-sm-12"},React.createElement("textarea",{name:"comment",id:"comment",className:"form-control thaana comment-box",onChange:this.props.charLimit,placeholder:"ކޮމެންޓް"}))),React.createElement("input",{className:"hidden",id:"avatarColor",name:"avatar_color",defaultValue:this.props.avatarColor}),React.createElement("div",{className:"send-opts col-sm-12"},React.createElement("div",{className:"row"},React.createElement("button",{type:"submit",className:"btn comment-send-btn",disabled:d||s},this.props.submitting?React.createElement("span",{className:"fa fa-circle-o-notch fa-spin"}):"ފޮނުވާ"),React.createElement("span",{className:this.props.charCount<1?"has-error-txt":""},this.props.charCount),React.createElement("a",{href:"/info/comment-guideline",target:"_blank"},"ކޮމެންޓުކުރުމުގެ ގައިޑްލައިންއަށް އެއްބަސްވަމެވެ.")))),React.createElement("div",{className:"clr"})))}}),LoadMoreButton=React.createClass({displayName:"LoadMoreButton",handleClick:function(e){e.preventDefault(),this.props.onLoadMoreClick()},render:function(){return React.createElement("div",{className:"text-center"},React.createElement("button",{name:"loadmore",style:{display:this.props.loading||this.props.total==this.props.to||0==this.props.total?"none":"inline-block"},className:"btn btn-default load-more",onClick:this.handleClick},"އިތުރު ކޮމެންޓުތައް"))}}),CommentLoading=React.createClass({displayName:"CommentLoading",render:function(){return React.createElement("div",{style:{textAlign:"center",margin:"10px 0px",display:this.props.loading?"block":"none"}},React.createElement("i",{className:"fa fa-circle-o-notch fa-spin"}))}}),CommentBox=React.createClass({displayName:"CommentBox",getInitialState:function(){return{data:[],comment:null,name:null,member_id:null,commentsLoaded:!1,errors:[],submitting:!1,loading:!1,total:null,per_page:null,current_page:null,last_page:null,next_page_url:null,prev_page_url:null,from:null,to:null,submitted:!1,sort:"date",sortLoading:!1,nameAvailabiltyLoading:!1,nameAvailabiltyCurrent:null,nameAvailable:null,charCount:450}},handleScroll:function(e){var t=$(".comments-container").eq(0).offset().top-$(".comments-container").eq(0).height();$(window).scrollTop()>t-1e3&&0==this.state.commentsLoaded&&(this.loadCommentsFromServer(),this.setState({commentsLoaded:!0}))},handleSubmit:function(e){e.preventDefault();var t={name:$(".comment-form.main-comment #name").val(),avatar_color:$(".comment-form.main-comment #avatarColor").val(),comment:$(".comment-form.main-comment #comment").val(),article_id:this.props.article_id,agree:0==$(".comment-form.main-comment #agree:checked").length?0:1,_token:$('meta[name="csrf-token"]').attr("content")};null!=this.props.account&&(t={name:this.props.account.dhivehi_name,avatar_color:$(".comment-form.main-comment #avatarColor").val(),comment:$(".comment-form.main-comment #comment").val(),article_id:this.props.article_id,agree:0==$(".comment-form.main-comment #agree:checked").length?0:1,_token:$('meta[name="csrf-token"]').attr("content"),member_id:this.props.account.id}),this.setState({submitting:!0}),$.ajax({url:"/json/dhivehi/comments",data:t,method:"POST",dataType:"json",success:function(e){this.setState({submitting:!1,submitted:!0}),$(".comment-form.main-comment").trigger("reset"),$(".comment-form.main-comment").slideUp()}.bind(this),error:function(e,t,a){if(e.responseJSON){this.setState({errors:JSON.parse(e.responseText),submitting:!1});for(var n in e.responseJSON)$(".comment-form.main-comment #"+n).parent().parent().addClass("has-error")}}.bind(this)})},handleLoadMoreClick:function(e){this.loadCommentsFromServer()},loadCommentsFromServer:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.props.comments>0&&(this.setState({loading:!0}),$.ajax({url:0==e&&this.state.next_page_url?this.state.next_page_url:"/json/dhivehi/comments/"+this.props.article_id,data:{_token:$('meta[name="csrf-token"]').attr("content"),sort:this.state.sort},method:"POST",dataType:"json",cache:!1,success:function(t){this.setState({data:1==e?t.data:this.state.total>this.state.per_page?this.state.data.concat(t.data):t.data,loading:!1,total:t.total,per_page:t.per_page,current_page:t.current_page,last_page:t.last_page,next_page_url:t.next_page_url,prev_page_url:t.prev_page_url,from:t.from,to:t.to,sortLoading:!1})}.bind(this),error:function(e,t,a){this.setState({loading:!1})}.bind(this)}))},handleSortChange:function(e){var t=this.state.sort!=e;this.setState({sort:e,sortLoading:!0},function(){this.loadCommentsFromServer(t)}.bind(this))},sortByDate:function(){this.handleSortChange("date")},sortByLikes:function(){this.handleSortChange("likes")},nameAvailabilty:function(){var e=$(".main-comment #name").val().trim(),t=$('meta[name="csrf-token"]').attr("content");this.setState({nameAvailabiltyCurrent:e}),this.setState({nameAvailable:null}),e.length>3&&""!=e&&0==this.state.nameAvailabiltyLoading&&(this.setState({nameAvailabiltyLoading:!0}),$.ajax({url:"/auth/name_available",data:{_token:t,dhivehi_name:e},method:"POST",dataType:"json",cache:!1,success:function(t){this.setState({nameAvailabiltyLoading:!1}),this.setState({nameAvailable:t}),this.state.nameAvailabiltyCurrent!=e&&this.nameAvailabilty()}.bind(this),error:function(e,t,a){}.bind(this)}))},validateChars:function(){var e=$(".main-comment #comment").val().trim(),t=(e.split(""),["😂","😃","😍","😘","😢","😡","😲","\0-香","ﷲ"]),a="";for(var n in t)a+=""!=a?"|"+t[n]:t[n];var s=new RegExp("[^"+a+"]");e=e.replace(s,""),$(".main-comment #comment").val(e)},charLimit:function(){var e=$(".main-comment #comment").val().trim(),t=e.length,a=450,n=a-t;this.setState({charCount:n})},insertEmoji:function(e){var t=["😂","😃","😍","😘","😢","😡","😲"],a=0,n=$(".main-comment #comment").val();for(var s in t){var i=new RegExp(t[s],"g"),r=n.match(i),c=null==r?0:r.length;a+=c}n=n+" "+e+" ",a<5&&$(".main-comment #comment").val(n),$(".main-comment #comment").focus()},componentDidMount:function(){$(".comment-form.main-comment .thaana").thaana(),window.addEventListener("scroll",this.handleScroll)},render:function(){var e="";this.state.total>0&&(e=React.createElement("div",{className:"comment-header"},React.createElement("div",{className:"title"},this.state.total," ކޮމެންޓް"),React.createElement("ul",{className:"tabbed-list"},React.createElement("li",{className:"likes"==this.state.sort?"active":""},React.createElement("a",{onClick:this.sortByLikes},"މަގުބޫލު")),React.createElement("li",{className:"date"==this.state.sort?"active":""},React.createElement("a",{onClick:this.sortByDate},"އެންމެފަސް"))),React.createElement("span",{className:"fa fa-circle-o-notch fa-spin",style:{display:this.state.sortLoading?"inline-block":"none","float":"left",lineHeight:"45px",marginLeft:"-15px"}})));var t;1==this.state.submitted&&(t=React.createElement(CommentSuccess,null));var a=["😂","😃","😍","😘","😢","😡","😲"];return React.createElement("div",{className:"commentBox"},React.createElement("div",{className:"comments-holder"},e),React.createElement(CommentForm,{avatarColor:this.props.avcolor,allowedEmojis:a,insertEmoji:this.insertEmoji,nameAvailabilty:this.nameAvailabilty,nameAvailable:this.state.nameAvailable,nameAvailabiltyLoading:this.state.nameAvailabiltyLoading,charLimit:this.charLimit,charCount:this.state.charCount,handleSubmit:this.handleSubmit,errors:this.state.errors,handleNameChange:this.handleNameChange,submitting:this.state.submitting,handleCommentChange:this.handleCommentChange,account:this.props.account,accounts_url:this.props.accounts_url}),React.createElement("hr",null),t,React.createElement(CommentList,{account:this.props.account,avatarColor:this.props.avcolor,data:this.state.data,total:this.state.total}),React.createElement(CommentLoading,{loading:this.state.loading}),React.createElement(LoadMoreButton,{to:this.state.to,total:this.state.total,loading:this.state.loading,onLoadMoreClick:this.handleLoadMoreClick}))}});ReactDOM.render(React.createElement(CommentBox,{avcolor:avatar_color,article_id:article_id,comments:comments,account:mihaaruAccount,accounts_url:accountsUrl}),document.getElementById("commentHolder"));